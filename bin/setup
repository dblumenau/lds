#!/bin/bash

# Laravel Swift Danish Setup Script
# This script sets up a fresh clone of the repository

set -e

echo "ğŸš€ Setting up Swift Danish (LDS)..."

# Check if we're in the right directory
if [ ! -f "artisan" ]; then
    echo "âŒ Error: This script must be run from the project root directory"
    exit 1
fi

# Create .env file if it doesn't exist
if [ ! -f ".env" ]; then
    echo "ğŸ“ Creating .env file..."
    cp .env.example .env
else
    echo "âœ… .env file already exists"
fi

# Install Composer dependencies
echo "ğŸ“¦ Installing PHP dependencies..."
composer install

# Generate application key
echo "ğŸ”‘ Generating application key..."
php artisan key:generate

# Create SQLite database file
echo "ğŸ—„ï¸  Creating SQLite database..."
touch database/database.sqlite

# Run migrations with seed
echo "ğŸŒ± Running migrations and seeders..."
php artisan migrate:fresh --seed

# Install NPM dependencies
echo "ğŸ“¦ Installing Node dependencies..."
npm install

# Build assets
echo "ğŸ—ï¸  Building assets..."
npm run build

# Clear caches
echo "ğŸ§¹ Clearing caches..."
php artisan optimize:clear

echo "âœ… Setup complete!"
echo ""
echo "ğŸ“Œ Next steps:"
echo "   1. Start the development servers:"
echo "      - Laravel: php artisan serve"
echo "      - Vite: npm run dev"
echo "   2. Or use the VS Code task: Run Task > start"
echo "   3. Visit https://lds.test (if using Laravel Valet)"
echo ""
echo "ğŸ” Default super admin credentials:"
echo "   Email: admin@example.com"
echo "   Password: password"